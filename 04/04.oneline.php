<?php echo array_sum(array_map(fn($card) => floor(pow(2, $card - 1)), $winners = array_map(fn ($card) => count(array_intersect(...array_map(fn ($sequence) => preg_split('/\s+/', $sequence, -1, 1), explode("|", explode(":", $card)[1])))), explode(PHP_EOL, file_get_contents('input'))))).PHP_EOL.array_sum(array_reduce(array_keys($winners), fn ($stack, $key) => array_reduce($winners[$key] > 0 ? range(1, $winners[$key]) : [], fn($stack, $i) => [$key+$i => $stack[$key] + $stack[$key+$i]] + $stack, $stack), array_fill(0, count($winners), 1))).PHP_EOL;